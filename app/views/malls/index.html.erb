<script src="//maps.google.com/maps/api/js?key=AIzaSyDoCKNEr65ZO2JvpuIbofP7cn8p3pqFJP4"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>

<div class="row mall_index_top">
  <div class="malls_title">
    <h1>MALLS</h1>
    <p>
      <b>Here, you can view all malls as well as search malls via location.</b>
    </p>
  </div>
  <br>
  <div class="search">
    <%= form_tag malls_path, :method => :get do%>
    <%=text_field_tag :search, params[:search], class:"form-control", placeholder:"search by location e.g. Nairobi.."%>
    <%=submit_tag "Search", :name => :nil, class: "search_btn"%>
    <%end%>
  </div>
</div>

<!--MALLS LIST-->
<div class="page-header">
  <h1>ALL MALLS</h1>
</div>
<% @malls.each do |mall| %>
<div class="row main">
  <div class="col-md-6 col-xs-12 details">
    <h1><%=mall.name%></h1>
    <h3 class="animated infinite headShake">
      <i class="fa fa-calendar" aria-hidden="true"></i><%=link_to mall_events_path(mall) do%><%=mall.events.count%> events happening here.<%end%></h3>
    <%if mall.parking_space == true%>
    <h3>
      <i class="fa fa-car" aria-hidden="true"></i>Parking available.</h3>
    <%else%>
    <h3>
      <i class="fa fa-car" aria-hidden="true"></i>Parking available.</h3>
    <%end%>
    <h3>
      <i class="fa fa-home" aria-hidden="true"></i><%=mall.rooms.count%>
      stores present.</h3>
    <%if ((mall.opening_time).strftime('%H:%M')..(mall.closing_time).strftime('%H:%M')).include?Time.now.strftime('%H:%M')%>
    <p>
      <span class="time">
        <i class="fa fa-clock-o" aria-hidden="true"></i>Currently Open</span>
    </p>
    <%else%>
    <p>
      <span class="time">
        <i class="fa fa-clock-o" aria-hidden="true"></i>Currently Open</span>
    </p>
    <%end%>
    <%if mall.rooms_status == false%>
    <h3>Fully occupied</h3>
    <%end%>
  </div>
  <div class="col-md-6 col-xs-12 view" style="background-image:url(<%=mall.mallpicture_url.to_s%>);">
    <%=link_to mall_path(mall) do%>
    <button class="btn btn-default mall animated infinite pulse">Take me there!</button>
    <%end%>
  </div>
</div>
<%end%>

<div class="mall_map">
  <p>Mall distrbution.</p>
  <div id="map"></div>
</div>


<script type="text/javascript">
  $(document).ready(function () {
    handler = Gmaps.build('Google');
    handler.buildMap({
      provider: {},
      internal: {
        id: 'map'
      }
    }, function () {
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  });
</script>
